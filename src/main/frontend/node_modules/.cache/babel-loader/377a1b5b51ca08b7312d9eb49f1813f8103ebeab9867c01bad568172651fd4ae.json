{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"@/utils/axios\";\nexport default {\n  name: \"BlogDetailView\",\n  data() {\n    return {\n      blog: null,\n      comments: [],\n      newComment: \"\",\n      currentPage: 1,\n      commentsPerPage: 3,\n      showReportSuccess: false\n    };\n  },\n  computed: {\n    paginatedComments() {\n      const start = (this.currentPage - 1) * this.commentsPerPage;\n      const end = start + this.commentsPerPage;\n      return this.comments.slice(start, end);\n    },\n    totalPages() {\n      return Math.ceil(this.comments.length / this.commentsPerPage);\n    },\n    isReviewMode() {\n      return this.$route.params.isReview === \"true\";\n    }\n  },\n  methods: {\n    getBackRoute() {\n      if (this.isReviewMode) {\n        return \"/admin/blog-review\";\n      }\n      return this.$route.query.fromMyBlogs ? {\n        name: \"MyBlogs\",\n        query: {\n          page: this.$route.query.page\n        }\n      } : \"/blogs\";\n    },\n    async fetchBlog() {\n      const blogId = this.$route.params.id;\n      try {\n        const response = await axios.get(`/blogs/${blogId}`);\n        this.blog = response.data;\n      } catch (error) {\n        console.error(\"获取博文详情失败\", error);\n      }\n    },\n    async fetchComments() {\n      const blogId = this.$route.params.id;\n      try {\n        const response = await axios.get(`/blogs/${blogId}/comments`);\n        this.comments = response.data;\n      } catch (error) {\n        console.error(\"获取评论失败\", error);\n      }\n    },\n    async addComment() {\n      const user = JSON.parse(localStorage.getItem(\"user\"));\n      if (this.newComment.trim() === \"\") return;\n      try {\n        const response = await axios.post(\"/comments\", {\n          author: user.nickname,\n          blogId: this.blog.id,\n          content: this.newComment\n        });\n        this.comments.push(response.data);\n        this.newComment = \"\";\n      } catch (error) {\n        console.error(\"发表评论失败\", error);\n      }\n    },\n    async reportComment(id) {\n      try {\n        const response = await axios.put(`/comments/${id}/report`);\n        if (response.data.success) {\n          this.showReportSuccess = true;\n        }\n      } catch (error) {\n        console.error(\"举报评论失败\", error);\n      }\n    },\n    async approveBlog() {\n      try {\n        await axios.put(`/blogs/${this.blog.id}`, {\n          title: this.blog.title,\n          content: this.blog.content,\n          status: \"published\"\n        });\n        this.$router.push(\"/admin/blog-review\");\n      } catch (error) {\n        console.error(\"审核通过失败\", error);\n      }\n    },\n    async rejectBlog() {\n      try {\n        await axios.put(`/blogs/${this.blog.id}`, {\n          title: this.blog.title,\n          content: this.blog.content,\n          status: \"rejected\"\n        });\n        this.$router.push(\"/admin/blog-review\");\n      } catch (error) {\n        console.error(\"审核不通过失败\", error);\n      }\n    },\n    closeReportSuccess() {\n      this.showReportSuccess = false;\n      this.fetchComments();\n    },\n    nextPage() {\n      if (this.currentPage < this.totalPages) {\n        this.currentPage++;\n      }\n    },\n    prevPage() {\n      if (this.currentPage > 1) {\n        this.currentPage--;\n      }\n    }\n  },\n  created() {\n    this.fetchBlog();\n    this.fetchComments();\n  }\n};","map":{"version":3,"names":["axios","name","data","blog","comments","newComment","currentPage","commentsPerPage","showReportSuccess","computed","paginatedComments","start","end","slice","totalPages","Math","ceil","length","isReviewMode","$route","params","isReview","methods","getBackRoute","query","fromMyBlogs","page","fetchBlog","blogId","id","response","get","error","console","fetchComments","addComment","user","JSON","parse","localStorage","getItem","trim","post","author","nickname","content","push","reportComment","put","success","approveBlog","title","status","$router","rejectBlog","closeReportSuccess","nextPage","prevPage","created"],"sources":["D:\\Code\\Project\\SNSproject\\SNS\\src\\main\\frontend\\src\\views\\blog\\user\\BlogDetailView.vue"],"sourcesContent":["<template>\r\n  <div class=\"blog-detail\" v-if=\"blog\">\r\n    <h1>{{ blog.title }}</h1>\r\n    <p>作者: {{ blog.author }}</p>\r\n    <p>发布时间: {{ blog.publishedAt }}</p>\r\n    <div v-html=\"blog.content\" class=\"content\"></div>\r\n    <div v-if=\"isReviewMode\" class=\"review-actions\">\r\n      <button @click=\"approveBlog\" class=\"approve-button\">过审核</button>\r\n      <button @click=\"rejectBlog\" class=\"reject-button\">不过审</button>\r\n    </div>\r\n    <router-link :to=\"getBackRoute()\" class=\"action-button\"\r\n      >返回列表</router-link\r\n    >\r\n\r\n    <h2>评论</h2>\r\n    <div v-if=\"comments.length > 0\" class=\"comments\">\r\n      <ul>\r\n        <li v-for=\"comment in paginatedComments\" :key=\"comment.id\">\r\n          <p class=\"comment-author\">\r\n            {{ comment.author }}\r\n            <button @click=\"reportComment(comment.id)\" class=\"report-button\">\r\n              举报\r\n            </button>\r\n          </p>\r\n          <p class=\"comment-content\">{{ comment.content }}</p>\r\n        </li>\r\n      </ul>\r\n      <div class=\"pagination\">\r\n        <button @click=\"prevPage\" :disabled=\"currentPage === 1\">上一页</button>\r\n        <span>第 {{ currentPage }} 页，共 {{ totalPages }} 页</span>\r\n        <button @click=\"nextPage\" :disabled=\"currentPage === totalPages\">\r\n          下一页\r\n        </button>\r\n      </div>\r\n    </div>\r\n    <div v-else>\r\n      <p>还没有评论...</p>\r\n    </div>\r\n\r\n    <div class=\"add-comment\">\r\n      <h3>发表评论</h3>\r\n      <textarea v-model=\"newComment\" placeholder=\"输入评论内容\"></textarea>\r\n      <button @click=\"addComment\" class=\"action-button\">发表</button>\r\n    </div>\r\n\r\n    <div v-if=\"showReportSuccess\" class=\"report-success\">\r\n      <div class=\"report-success-box\">\r\n        <p>举报成功</p>\r\n        <button @click=\"closeReportSuccess\" class=\"confirm-button\">确定</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div v-else>\r\n    <p>加载中...</p>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"@/utils/axios\";\r\n\r\nexport default {\r\n  name: \"BlogDetailView\",\r\n  data() {\r\n    return {\r\n      blog: null,\r\n      comments: [],\r\n      newComment: \"\",\r\n      currentPage: 1,\r\n      commentsPerPage: 3,\r\n      showReportSuccess: false,\r\n    };\r\n  },\r\n  computed: {\r\n    paginatedComments() {\r\n      const start = (this.currentPage - 1) * this.commentsPerPage;\r\n      const end = start + this.commentsPerPage;\r\n      return this.comments.slice(start, end);\r\n    },\r\n    totalPages() {\r\n      return Math.ceil(this.comments.length / this.commentsPerPage);\r\n    },\r\n    isReviewMode() {\r\n      return this.$route.params.isReview === \"true\";\r\n    },\r\n  },\r\n  methods: {\r\n    getBackRoute() {\r\n      if (this.isReviewMode) {\r\n        return \"/admin/blog-review\";\r\n      }\r\n      return this.$route.query.fromMyBlogs\r\n        ? { name: \"MyBlogs\", query: { page: this.$route.query.page } }\r\n        : \"/blogs\";\r\n    },\r\n    async fetchBlog() {\r\n      const blogId = this.$route.params.id;\r\n      try {\r\n        const response = await axios.get(`/blogs/${blogId}`);\r\n        this.blog = response.data;\r\n      } catch (error) {\r\n        console.error(\"获取博文详情失败\", error);\r\n      }\r\n    },\r\n    async fetchComments() {\r\n      const blogId = this.$route.params.id;\r\n      try {\r\n        const response = await axios.get(`/blogs/${blogId}/comments`);\r\n        this.comments = response.data;\r\n      } catch (error) {\r\n        console.error(\"获取评论失败\", error);\r\n      }\r\n    },\r\n    async addComment() {\r\n      const user = JSON.parse(localStorage.getItem(\"user\"));\r\n      if (this.newComment.trim() === \"\") return;\r\n      try {\r\n        const response = await axios.post(\"/comments\", {\r\n          author: user.nickname,\r\n          blogId: this.blog.id,\r\n          content: this.newComment,\r\n        });\r\n        this.comments.push(response.data);\r\n        this.newComment = \"\";\r\n      } catch (error) {\r\n        console.error(\"发表评论失败\", error);\r\n      }\r\n    },\r\n    async reportComment(id) {\r\n      try {\r\n        const response = await axios.put(`/comments/${id}/report`);\r\n        if (response.data.success) {\r\n          this.showReportSuccess = true;\r\n        }\r\n      } catch (error) {\r\n        console.error(\"举报评论失败\", error);\r\n      }\r\n    },\r\n    async approveBlog() {\r\n      try {\r\n        await axios.put(`/blogs/${this.blog.id}`, {\r\n          title: this.blog.title,\r\n          content: this.blog.content,\r\n          status: \"published\",\r\n        });\r\n        this.$router.push(\"/admin/blog-review\");\r\n      } catch (error) {\r\n        console.error(\"审核通过失败\", error);\r\n      }\r\n    },\r\n    async rejectBlog() {\r\n      try {\r\n        await axios.put(`/blogs/${this.blog.id}`, {\r\n          title: this.blog.title,\r\n          content: this.blog.content,\r\n          status: \"rejected\",\r\n        });\r\n        this.$router.push(\"/admin/blog-review\");\r\n      } catch (error) {\r\n        console.error(\"审核不通过失败\", error);\r\n      }\r\n    },\r\n    closeReportSuccess() {\r\n      this.showReportSuccess = false;\r\n      this.fetchComments();\r\n    },\r\n    nextPage() {\r\n      if (this.currentPage < this.totalPages) {\r\n        this.currentPage++;\r\n      }\r\n    },\r\n    prevPage() {\r\n      if (this.currentPage > 1) {\r\n        this.currentPage--;\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    this.fetchBlog();\r\n    this.fetchComments();\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.blog-detail {\r\n  padding: 20px;\r\n  background: #f9f9f9;\r\n  border-radius: 10px;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.blog-detail h1 {\r\n  margin-top: 0;\r\n}\r\n\r\n.blog-detail p {\r\n  margin: 10px 0;\r\n}\r\n\r\n.blog-detail .content {\r\n  margin-top: 20px;\r\n  padding: 20px;\r\n  background: white;\r\n  border-radius: 10px;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.review-actions {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.approve-button {\r\n  padding: 10px 20px;\r\n  background-color: #42b983;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 10px;\r\n  cursor: pointer;\r\n}\r\n\r\n.approve-button:hover {\r\n  background-color: #358a66;\r\n}\r\n\r\n.reject-button {\r\n  padding: 10px 20px;\r\n  background-color: #e74c3c;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 10px;\r\n  cursor: pointer;\r\n}\r\n\r\n.reject-button:hover {\r\n  background-color: #c0392b;\r\n}\r\n\r\n.action-button {\r\n  padding: 10px 20px;\r\n  margin: 20px 0;\r\n  background-color: #42b983;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 10px;\r\n  cursor: pointer;\r\n  display: inline-block;\r\n  text-align: center;\r\n  text-decoration: none;\r\n}\r\n\r\n.action-button:hover {\r\n  background-color: #358a66;\r\n}\r\n\r\n.comments {\r\n  margin-top: 20px;\r\n  background: #eef2f3;\r\n  padding: 20px;\r\n  border-radius: 10px;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.comment-author {\r\n  font-size: 18px;\r\n  font-weight: bold;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.comment-content {\r\n  font-size: 14px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.report-button {\r\n  padding: 5px 10px;\r\n  margin-left: 10px;\r\n  background-color: #e74c3c;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 5px;\r\n  cursor: pointer;\r\n}\r\n\r\n.report-button:hover {\r\n  background-color: #c0392b;\r\n}\r\n\r\n.add-comment {\r\n  margin-top: 20px;\r\n}\r\n\r\n.add-comment textarea {\r\n  width: 100%;\r\n  height: 100px;\r\n  padding: 10px;\r\n  box-sizing: border-box;\r\n  border-radius: 10px;\r\n  border: 1px solid #ccc;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.pagination {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-top: 20px;\r\n}\r\n\r\n.pagination button {\r\n  padding: 10px 20px;\r\n  background-color: #42b983;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 10px;\r\n  cursor: pointer;\r\n}\r\n\r\n.pagination button:hover {\r\n  background-color: #358a66;\r\n}\r\n\r\n.report-success {\r\n  background: rgba(0, 0, 0, 0.8);\r\n  color: white;\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.report-success-box {\r\n  background: #2c3e50;\r\n  padding: 40px;\r\n  border-radius: 30px;\r\n  text-align: center;\r\n  width: 400px;\r\n}\r\n\r\n.confirm-button {\r\n  padding: 15px 30px;\r\n  background-color: #42b983;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 10px;\r\n  cursor: pointer;\r\n  margin-top: 20px;\r\n  font-size: 16px;\r\n}\r\n\r\n.confirm-button:hover {\r\n  background-color: #358a66;\r\n}\r\n</style>\r\n"],"mappings":";AA0DA,OAAOA,KAAI,MAAO,eAAe;AAEjC,eAAe;EACbC,IAAI,EAAE,gBAAgB;EACtBC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,IAAI,EAAE,IAAI;MACVC,QAAQ,EAAE,EAAE;MACZC,UAAU,EAAE,EAAE;MACdC,WAAW,EAAE,CAAC;MACdC,eAAe,EAAE,CAAC;MAClBC,iBAAiB,EAAE;IACrB,CAAC;EACH,CAAC;EACDC,QAAQ,EAAE;IACRC,iBAAiBA,CAAA,EAAG;MAClB,MAAMC,KAAI,GAAI,CAAC,IAAI,CAACL,WAAU,GAAI,CAAC,IAAI,IAAI,CAACC,eAAe;MAC3D,MAAMK,GAAE,GAAID,KAAI,GAAI,IAAI,CAACJ,eAAe;MACxC,OAAO,IAAI,CAACH,QAAQ,CAACS,KAAK,CAACF,KAAK,EAAEC,GAAG,CAAC;IACxC,CAAC;IACDE,UAAUA,CAAA,EAAG;MACX,OAAOC,IAAI,CAACC,IAAI,CAAC,IAAI,CAACZ,QAAQ,CAACa,MAAK,GAAI,IAAI,CAACV,eAAe,CAAC;IAC/D,CAAC;IACDW,YAAYA,CAAA,EAAG;MACb,OAAO,IAAI,CAACC,MAAM,CAACC,MAAM,CAACC,QAAO,KAAM,MAAM;IAC/C;EACF,CAAC;EACDC,OAAO,EAAE;IACPC,YAAYA,CAAA,EAAG;MACb,IAAI,IAAI,CAACL,YAAY,EAAE;QACrB,OAAO,oBAAoB;MAC7B;MACA,OAAO,IAAI,CAACC,MAAM,CAACK,KAAK,CAACC,WAAU,GAC/B;QAAExB,IAAI,EAAE,SAAS;QAAEuB,KAAK,EAAE;UAAEE,IAAI,EAAE,IAAI,CAACP,MAAM,CAACK,KAAK,CAACE;QAAK;MAAE,IAC3D,QAAQ;IACd,CAAC;IACD,MAAMC,SAASA,CAAA,EAAG;MAChB,MAAMC,MAAK,GAAI,IAAI,CAACT,MAAM,CAACC,MAAM,CAACS,EAAE;MACpC,IAAI;QACF,MAAMC,QAAO,GAAI,MAAM9B,KAAK,CAAC+B,GAAG,CAAC,UAAUH,MAAM,EAAE,CAAC;QACpD,IAAI,CAACzB,IAAG,GAAI2B,QAAQ,CAAC5B,IAAI;MAC3B,EAAE,OAAO8B,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,UAAU,EAAEA,KAAK,CAAC;MAClC;IACF,CAAC;IACD,MAAME,aAAaA,CAAA,EAAG;MACpB,MAAMN,MAAK,GAAI,IAAI,CAACT,MAAM,CAACC,MAAM,CAACS,EAAE;MACpC,IAAI;QACF,MAAMC,QAAO,GAAI,MAAM9B,KAAK,CAAC+B,GAAG,CAAC,UAAUH,MAAM,WAAW,CAAC;QAC7D,IAAI,CAACxB,QAAO,GAAI0B,QAAQ,CAAC5B,IAAI;MAC/B,EAAE,OAAO8B,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,QAAQ,EAAEA,KAAK,CAAC;MAChC;IACF,CAAC;IACD,MAAMG,UAAUA,CAAA,EAAG;MACjB,MAAMC,IAAG,GAAIC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC;MACrD,IAAI,IAAI,CAACnC,UAAU,CAACoC,IAAI,CAAC,MAAM,EAAE,EAAE;MACnC,IAAI;QACF,MAAMX,QAAO,GAAI,MAAM9B,KAAK,CAAC0C,IAAI,CAAC,WAAW,EAAE;UAC7CC,MAAM,EAAEP,IAAI,CAACQ,QAAQ;UACrBhB,MAAM,EAAE,IAAI,CAACzB,IAAI,CAAC0B,EAAE;UACpBgB,OAAO,EAAE,IAAI,CAACxC;QAChB,CAAC,CAAC;QACF,IAAI,CAACD,QAAQ,CAAC0C,IAAI,CAAChB,QAAQ,CAAC5B,IAAI,CAAC;QACjC,IAAI,CAACG,UAAS,GAAI,EAAE;MACtB,EAAE,OAAO2B,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,QAAQ,EAAEA,KAAK,CAAC;MAChC;IACF,CAAC;IACD,MAAMe,aAAaA,CAAClB,EAAE,EAAE;MACtB,IAAI;QACF,MAAMC,QAAO,GAAI,MAAM9B,KAAK,CAACgD,GAAG,CAAC,aAAanB,EAAE,SAAS,CAAC;QAC1D,IAAIC,QAAQ,CAAC5B,IAAI,CAAC+C,OAAO,EAAE;UACzB,IAAI,CAACzC,iBAAgB,GAAI,IAAI;QAC/B;MACF,EAAE,OAAOwB,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,QAAQ,EAAEA,KAAK,CAAC;MAChC;IACF,CAAC;IACD,MAAMkB,WAAWA,CAAA,EAAG;MAClB,IAAI;QACF,MAAMlD,KAAK,CAACgD,GAAG,CAAC,UAAU,IAAI,CAAC7C,IAAI,CAAC0B,EAAE,EAAE,EAAE;UACxCsB,KAAK,EAAE,IAAI,CAAChD,IAAI,CAACgD,KAAK;UACtBN,OAAO,EAAE,IAAI,CAAC1C,IAAI,CAAC0C,OAAO;UAC1BO,MAAM,EAAE;QACV,CAAC,CAAC;QACF,IAAI,CAACC,OAAO,CAACP,IAAI,CAAC,oBAAoB,CAAC;MACzC,EAAE,OAAOd,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,QAAQ,EAAEA,KAAK,CAAC;MAChC;IACF,CAAC;IACD,MAAMsB,UAAUA,CAAA,EAAG;MACjB,IAAI;QACF,MAAMtD,KAAK,CAACgD,GAAG,CAAC,UAAU,IAAI,CAAC7C,IAAI,CAAC0B,EAAE,EAAE,EAAE;UACxCsB,KAAK,EAAE,IAAI,CAAChD,IAAI,CAACgD,KAAK;UACtBN,OAAO,EAAE,IAAI,CAAC1C,IAAI,CAAC0C,OAAO;UAC1BO,MAAM,EAAE;QACV,CAAC,CAAC;QACF,IAAI,CAACC,OAAO,CAACP,IAAI,CAAC,oBAAoB,CAAC;MACzC,EAAE,OAAOd,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;MACjC;IACF,CAAC;IACDuB,kBAAkBA,CAAA,EAAG;MACnB,IAAI,CAAC/C,iBAAgB,GAAI,KAAK;MAC9B,IAAI,CAAC0B,aAAa,CAAC,CAAC;IACtB,CAAC;IACDsB,QAAQA,CAAA,EAAG;MACT,IAAI,IAAI,CAAClD,WAAU,GAAI,IAAI,CAACQ,UAAU,EAAE;QACtC,IAAI,CAACR,WAAW,EAAE;MACpB;IACF,CAAC;IACDmD,QAAQA,CAAA,EAAG;MACT,IAAI,IAAI,CAACnD,WAAU,GAAI,CAAC,EAAE;QACxB,IAAI,CAACA,WAAW,EAAE;MACpB;IACF;EACF,CAAC;EACDoD,OAAOA,CAAA,EAAG;IACR,IAAI,CAAC/B,SAAS,CAAC,CAAC;IAChB,IAAI,CAACO,aAAa,CAAC,CAAC;EACtB;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}